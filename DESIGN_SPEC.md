# Career Agent System Design Specification

## 1. Architecture Diagram

```mermaid
graph TD
    User[User] -->|Web UI (React)| Frontend[Frontend (Vercel)]
    Frontend -->|API Requests| Backend[Backend API (FastAPI/Railway)]
    
    subgraph Backend System
        Backend -->|Orchestration| Agent[LangChain Agent]
        Agent -->|Tool Calls| Tools[Tools Layer]
        
        Tools -->|Scraping| Scraper[Playwright/Scrapers]
        Tools -->|Parsing/Reasoning| LLM[LLM (OpenAI/Anthropic)]
        Tools -->|Data Storage| DB[(PostgreSQL)]
        Tools -->|File Storage| Storage[S3/Supabase Storage]
        Tools -->|Email| Email[SMTP/SendGrid]
        
        Scraper -->|Job Data| External[Job Boards (Indeed, LinkedIn, etc.)]
        Scraper -->|Project Data| GitHub[GitHub/HuggingFace]
        
        Agent -->|Auto-Apply| Browser[Browser Automation]
        Browser -->|Submit| External
    end
    
    Backend -->|Async Tasks| Worker[Background Worker]
    Worker -->|Scheduled Scrape| Scraper
```

## 2. Folder Structure

```text
/
├── .github/
│   └── workflows/
│       ├── test.yml
│       └── deploy.yml
├── backend/
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py              # FastAPI entry point
│   │   ├── agent.py             # LangChain agent config
│   │   ├── models.py            # SQLAlchemy models
│   │   ├── schemas.py           # Pydantic models
│   │   ├── database.py          # DB connection
│   │   ├── config.py            # Env vars
│   │   └── tools/
│   │       ├── __init__.py
│   │       ├── job_tools.py     # Scrape, dedupe, parse
│   │       ├── resume_tools.py  # Rewrite, add projects
│   │       ├── apply_tools.py   # Browser automation
│   │       └── analytics_tools.py
│   ├── tests/
│   ├── requirements.txt
│   ├── Dockerfile
│   └── alembic/                 # DB Migrations
├── frontend/                    # React App
│   ├── public/
│   ├── src/
│   │   ├── components/
│   │   │   ├── JobCard.jsx
│   │   │   ├── Dashboard.jsx
│   │   │   └── ...
│   │   ├── pages/
│   │   ├── services/
│   │   ├── App.jsx
│   │   └── index.css            # Tailwind imports
│   ├── package.json
│   ├── tailwind.config.js
│   └── vite.config.js
├── scripts/
│   ├── setup.sh
│   └── deploy.sh
├── .env.example
├── README.md
└── docker-compose.yml
```

## 3. SQL Schema (PostgreSQL)

```sql
-- Users
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    hashed_password VARCHAR(255) NOT NULL,
    full_name VARCHAR(255),
    settings JSONB DEFAULT '{}', -- preferences, api keys
    created_at TIMESTAMP DEFAULT NOW()
);

-- Jobs
CREATE TABLE jobs (
    id SERIAL PRIMARY KEY,
    url VARCHAR(512) UNIQUE NOT NULL,
    source VARCHAR(50),
    title VARCHAR(255) NOT NULL,
    company VARCHAR(255) NOT NULL,
    location VARCHAR(255),
    posted_date TIMESTAMP,
    raw_text TEXT,
    parsed_json JSONB, -- structured JD
    is_scam BOOLEAN DEFAULT FALSE,
    scam_reason TEXT,
    match_score FLOAT,
    match_breakdown JSONB,
    status VARCHAR(50) DEFAULT 'scraped', -- scraped, matched, applied, rejected
    scraped_at TIMESTAMP DEFAULT NOW()
);

-- Resumes
CREATE TABLE resumes (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    version_name VARCHAR(100),
    content TEXT NOT NULL, -- Markdown or JSON
    is_base BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Projects
CREATE TABLE projects (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    job_id INTEGER REFERENCES jobs(id), -- if generated for a specific job
    title VARCHAR(255) NOT NULL,
    description TEXT,
    tech_stack JSONB,
    link VARCHAR(512),
    is_autogenerated BOOLEAN DEFAULT FALSE,
    metadata_json JSONB,
    added_at TIMESTAMP DEFAULT NOW()
);

-- Cover Letters
CREATE TABLE cover_letters (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    job_id INTEGER REFERENCES jobs(id),
    content TEXT NOT NULL,
    personality VARCHAR(50),
    created_at TIMESTAMP DEFAULT NOW()
);

-- Applications
CREATE TABLE applications (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    job_id INTEGER REFERENCES jobs(id),
    resume_id INTEGER REFERENCES resumes(id),
    cover_letter_id INTEGER REFERENCES cover_letters(id),
    status VARCHAR(50), -- submitted, interview, offer, rejected
    response_content TEXT,
    screenshot_url VARCHAR(512),
    applied_at TIMESTAMP DEFAULT NOW(),
    metadata_json JSONB
);

-- Analytics
CREATE TABLE daily_metrics (
    id SERIAL PRIMARY KEY,
    date DATE UNIQUE DEFAULT CURRENT_DATE,
    jobs_scraped INTEGER DEFAULT 0,
    jobs_matched INTEGER DEFAULT 0,
    applications_sent INTEGER DEFAULT 0,
    scams_detected INTEGER DEFAULT 0
);
```

## 4. Tool-calling JSON Schemas

```json
[
  {
    "name": "scrape_jobs",
    "description": "Scrapes job listings for a given region and role.",
    "parameters": {
      "type": "object",
      "properties": {
        "region": {"type": "string"},
        "role": {"type": "string"},
        "platforms": {"type": "array", "items": {"type": "string"}},
        "since_timestamp": {"type": "string", "format": "date-time"}
      },
      "required": ["region", "role"]
    }
  },
  {
    "name": "detect_scam",
    "description": "Analyzes a job record for scam indicators.",
    "parameters": {
      "type": "object",
      "properties": {
        "job_record": {
            "type": "object",
            "description": "The job data including description, company, etc."
        }
      },
      "required": ["job_record"]
    }
  },
  {
    "name": "compute_match_score",
    "description": "Calculates a match score between resume and job description.",
    "parameters": {
      "type": "object",
      "properties": {
        "resume_text": {"type": "string"},
        "structured_jd": {"type": "object"},
        "projects": {"type": "array", "items": {"type": "object"}}
      },
      "required": ["resume_text", "structured_jd"]
    }
  },
  {
    "name": "submit_application",
    "description": "Automates the browser to submit a job application.",
    "parameters": {
      "type": "object",
      "properties": {
        "job_url": {"type": "string"},
        "form_data": {"type": "object"},
        "resume_path": {"type": "string"},
        "cover_letter_path": {"type": "string"}
      },
      "required": ["job_url", "form_data"]
    }
  }
]
```

## 5. LangChain Agent Configuration

```python
from langchain.agents import AgentExecutor, create_openai_tools_agent
from langchain_openai import ChatOpenAI
from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder
from app.tools import job_tools, resume_tools, apply_tools

# 1. Define Tools
tools = [
    job_tools.scrape_jobs,
    job_tools.detect_scam,
    job_tools.parse_jd,
    job_tools.compute_match_score,
    resume_tools.rewrite_resume,
    resume_tools.generate_cover_letter,
    apply_tools.submit_application
]

# 2. Initialize LLM
llm = ChatOpenAI(model="gpt-4-turbo", temperature=0)

# 3. Create Prompt
prompt = ChatPromptTemplate.from_messages([
    ("system", "You are an Autonomous Career Agent. Your goal is to find, analyze, and apply to jobs."),
    ("user", "{input}"),
    MessagesPlaceholder(variable_name="agent_scratchpad"),
])

# 4. Create Agent
agent = create_openai_tools_agent(llm, tools, prompt)

# 5. Create Executor
agent_executor = AgentExecutor(agent=agent, tools=tools, verbose=True)

# Usage
# agent_executor.invoke({"input": "Find Python jobs in SF and apply to the best one."})
```

## 6. CI/CD + GitHub Actions

`.github/workflows/deploy.yml`:

```yaml
name: Deploy Career Agent

on:
  push:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install Dependencies
      run: |
        pip install -r backend/requirements.txt
        
    - name: Run Tests
      run: |
        pytest backend/tests
        
    - name: Deploy Backend to Railway
      if: success()
      run: |
        # Example using Railway CLI or webhook
        curl -X POST ${{ secrets.RAILWAY_DEPLOY_WEBHOOK }}
        
    - name: Build Frontend
      run: |
        cd frontend
        npm install
        npm run build
        
    - name: Deploy Frontend to Vercel
      if: success()
      uses: amondnet/vercel-action@v20
      with:
        vercel-token: ${{ secrets.VERCEL_TOKEN }}
        vercel-org-id: ${{ secrets.ORG_ID }}
        vercel-project-id: ${{ secrets.PROJECT_ID }}
        working-directory: ./frontend
```

## 7. Example End-to-End JSON Workflow

```json
{
  "workflow_id": "wf_12345",
  "timestamp": "2023-10-27T10:00:00Z",
  "steps": [
    {
      "step": "scrape",
      "input": {"region": "San Francisco", "role": "Senior Backend Engineer"},
      "output": {
        "jobs_found": 15,
        "new_jobs": 3
      }
    },
    {
      "step": "analyze_job",
      "job_id": 101,
      "url": "https://indeed.com/viewjob?jk=...",
      "scam_check": {"is_scam": false, "score": 0},
      "parsed_jd": {
        "skills": ["Python", "FastAPI", "AWS"],
        "seniority": "Senior",
        "salary": "$150k-$200k"
      }
    },
    {
      "step": "match",
      "job_id": 101,
      "match_score": 85,
      "breakdown": {"skills": 90, "experience": 80}
    },
    {
      "step": "tailor_application",
      "job_id": 101,
      "actions": [
        {"action": "add_project", "project": "High-Load API Demo"},
        {"action": "rewrite_resume", "version_id": 5},
        {"action": "generate_cover_letter", "personality": "professional"}
      ]
    },
    {
      "step": "auto_apply",
      "job_id": 101,
      "status": "success",
      "confirmation": "Application submitted successfully. ID: APP-999"
    }
  ]
}
```
